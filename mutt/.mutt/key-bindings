# === Key bindings ===
bind attach         <enter>     view-mailcap    # 'enter' runs html-viewer defined in mailcap on attachment
bind editor         <Tab>       complete-query  # 'Tab' completes query_command
bind editor         ^T          complete        # '^T' completes alias
bind pager          <up>        previous-line
bind pager          <down>      next-line
bind pager          <left>      previous-entry
bind pager          <right>     next-entry
bind pager,index    <space>     next-unread
bind index          g           first-entry
bind index          G           last-entry
bind index          <insert>    tag-entry       # 'insert' tags messages (like in mc)
bind index          *           tag-entry
bind index          /           search-reverse  # '/' as default search (reverse behavior)
bind index          <ESC>/      search
bind index          -           collapse-thread
bind index          _           collapse-all
bind index          x           next-unread-mailbox
bind compose        f           edit-from
bind compose        <ESC>f      edit-fcc


# === Key bindings (macros) ===
macro index         d           "<enter-command>set resolve=no<enter>\
<tag-prefix><clear-flag>N\
<enter-command>set resolve=yes<enter>\
<tag-prefix><delete-message><sync-mailbox>"                                 "mark message as read and move immediately to trash"
macro index         $           "<shell-escape>~/.mutt/sync_imap.sh<enter>" "run offlineimap to sync all mail"
#macro index         a           "M <limit>all<enter><collapse-all>"         "show all messages (undo limit)"
macro index         R           "T~N<enter>;WO\CT~T<enter>"                 "mark all messages as read"             # see http://blog.jwcxz.com/?p=810
macro index,pager   A           "<pipe-message>khard add-email<enter>"      "add the sender email address to khard"
macro index,pager   S           "<pipe-message>ripmime -i - -d ~/Downloads && rm ~/Downloads/textfile*<enter>" "Save all non-text attachments using ripmime"
macro index,pager   H           "<pipe-message>htmail-decode<enter>"        "render html mail using htmail-view"    # see https://github.com/liske/htmail-view
                                                                                                                    # requires libmime-tools-perl
# urlscan
macro index,pager \cb "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"

# === Key bindings (search) ===
# 'L' performs a notmuch query, showing only the results
macro index L "<enter-command>unset wait_key<enter>\
<shell-escape>read -p 'notmuch query: ' x; echo \$x >~/.cache/mutt_terms<enter>\
<limit>~i \"\`notmuch search --output=messages \$(cat ~/.cache/mutt_terms) | head -n 600 | perl -le '@a=<>;chomp@a;s/\^id:// for@a;$,=\"|\";print@a'\`\"<enter>"\
                "show only messages matching a notmuch pattern"
# For possible limit options, see
# http://www.mutt.org/doc/manual/#patterns
# 'a' shows all messages again (supersedes default <alias> binding)
macro index a "<limit>all<enter>" "show all messages (undo limit)"
# 'n' show only new/unread messages
macro index n "<limit>~U<enter>" "show all unread messages"

# vim: ft=muttrc
